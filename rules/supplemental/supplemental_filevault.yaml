id: supplemental_filevault
title: "FileVault Supplemental"
discussion: |
  In macOS 10.15 the internal APFS volume (System & Data) can be protected by FileVault. On non-T2 hardware, FileVault uses an AES-XTS data encryption algorithm to protect full volumes on internal and external storage. Macs with the T2 chip utilize the hardware security features of the chip.

  FileVault2 is described in link:https://support.apple.com/guide/security/when-filevault-is-turned-on-sec4c6dc1b6e/1/web/1[] 
  
  FileVault can be enabled in two ways within the macOS. It can be managed using the fdesetup command or by a Configuration Profile. When enabling FileVault, the user name and password must be a local OpenDirectory account with a valid SecureToken password.

  Using the command line in the Terminal application you can run the following command.
  
  [source,bash]
  ----
  /usr/bin/fdesetup enable
  ----
  This will enable FileVault after prompting for a user name and password, and return the personal recovery key. 
  There are a number of management features available when managing FileVault using the command line instead of a configuration profile. These are available in the manpage for fdesetup. 
  
  NOTE: Apple has deprecated fdesetup command line tool from recognizing user name and password for security reasons and may remove the ability in future versions of macOS.
  
  When managing FileVault with a configuration profile you must deploy a profile with the payload type of com.apple.MCX.FileVault2. When using the key enable to enable FileVault with a configuration profile, you must include 1 of the following:
  
  [source,xml]
  ----
  <key>Enable</key>
  <string>On</string>
  <key>Defer</key>
  <true />
  ----
  [source,xml]
  ----
  <key>Enable</key>
  <string>On</string>
  <key>UserEntersMissingInfo</key>
  <true/>
  ----

  If using the Defer key it will prompt for the user name and password at logout.

  If using the key UserEntersMissingInfo it will only work if installed through manual installation and will prompt for the user name and password.

  When using a configuration profile you can escrow the Recovery Key to an MDM Server. Documentation for that can be found on link:https://developer.apple.com/documentation/devicemanagement/fderecoverykeyescrow[Apple's Developer site].
  
  It's recommended that you use a Personal Recovery Key instead of an Institutional Key as it will generate a specific key for each device.  

  NOTE: FileVault currently only uses password based authentication and can not use a smartcard or any other type of multi-factor authentication.
check: |
fix: |
references:
  cci:
    - N/A
  800-53r4: 
    - N/A
  srg: 
    - N/A
  disa_stig:
    - N/A
macOS:
  - "10.15"
tags:
  - supplemental
mobileconfig: false
mobileconfig_info: